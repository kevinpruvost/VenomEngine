\doxysection{ECS.\+h}
\hypertarget{_e_c_s_8h_source}{}\label{_e_c_s_8h_source}\index{/Users/kevinpruvost/Bossing/Perso/VenomEngine/lib/common/include/venom/common/ECS.h@{/Users/kevinpruvost/Bossing/Perso/VenomEngine/lib/common/include/venom/common/ECS.h}}
\mbox{\hyperlink{_e_c_s_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_d_l_l_8h}{venom/common/DLL.h}}>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{common_2include_2venom_2common_2plugin_2graphics_2_g_u_i_8h}{venom/common/plugin/graphics/GUI.h}}>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <flecs.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_functional_8h}{venom/common/Functional.h}}>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_containers_8h}{venom/common/Containers.h}}>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevenom}{venom}}}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevenom_1_1common}{common}}}
\DoxyCodeLine{00020\ \{}
\DoxyCodeLine{00021\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvenom_1_1common_1_1_e_c_s}{ECS}};}
\DoxyCodeLine{00022\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvenom_1_1common_1_1_g_u_i}{GUI}};}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{using\ }Entity\ =\ flecs::entity;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{typedef}\ flecs::system\ System;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }VENOM\_COMMON\_API\ StaticVenomCanCreateComponent}
\DoxyCodeLine{00029\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \ \ StaticVenomCanCreateComponent(\textcolor{keyword}{const}\ vc::String\ \&\ componentName,\ vc::Function<bool,\ Entity>\ canCreateFunc);}
\DoxyCodeLine{00032\ \};}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ COMPONENT\_CAN\_ADD\_DEFINITION(COMPONENT\_NAME,\ BODY)\ \(\backslash\)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \ \ class\ COMPONENT\_NAME\#\#\_CanAdd\ :\ public\ StaticVenomCanCreateComponent\ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ \{\ \(\backslash\)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \ \ public:\ \(\backslash\)}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ COMPONENT\_NAME\#\#\_CanAdd()\ \(\backslash\)}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ :\ StaticVenomCanCreateComponent(\#COMPONENT\_NAME,\ [](Entity\ entity)\ \{\ \(\backslash\)}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ BODY\ \(\backslash\)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \})\ \(\backslash\)}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \{\ \(\backslash\)}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \}\ \(\backslash\)}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\ \ \ \ \};\ \(\backslash\)}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\ \ \ \ static\ COMPONENT\_NAME\#\#\_CanAdd\ s\_\#\#COMPONENT\_NAME\#\#\_CanAdd;}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{class\ }VENOM\_COMMON\_API\ VenomComponent}
\DoxyCodeLine{00048\ \{}
\DoxyCodeLine{00049\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00050\ \ \ \ \ VenomComponent();}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~VenomComponent()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{inline}\ vc::String\ GetComponentTitle()\ \{\ \textcolor{keywordflow}{return}\ \_GetComponentTitle();\ \}}
\DoxyCodeLine{00054\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \_GUI(\textcolor{keyword}{const}\ Entity\ entity)\ =\ 0;}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{virtual}\ vc::String\ \_GetComponentTitle()\ =\ 0;}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ Init(Entity\ entity);}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ Update(Entity\ entity)\ =\ 0;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ CanRemove(Entity\ entity)\ =\ 0;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{enum\ class}\ GUIComponentAction}
\DoxyCodeLine{00064\ \ \ \ \ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ None,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ Remove}
\DoxyCodeLine{00067\ \ \ \ \ \};}
\DoxyCodeLine{00068\ \ \ \ \ GUIComponentAction\ \_\_GUI(\textcolor{keyword}{const}\ Entity\ entity);}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{void}\ \_\_Init(Entity\ entity);}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_\_initialized;}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }ECS;}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }GUI;}
\DoxyCodeLine{00076\ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classvenom_1_1common_1_1_venom_component}{VenomComponent}}\ Component;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00081\ \textcolor{keyword}{concept\ }\mbox{\hyperlink{conceptvenom_1_1common_1_1_inherits_from_component}{InheritsFromComponent}}\ =\ std::derived\_from<T,\ vc::VenomComponent>;}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00089\ \textcolor{keyword}{class\ }VENOM\_COMMON\_API\ ECS}
\DoxyCodeLine{00090\ \{}
\DoxyCodeLine{00091\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00092\ \ \ \ \ ECS();}
\DoxyCodeLine{00093\ \ \ \ \ \string~ECS();}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{template}\ <InheritsFromComponent\ T>}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ RegisterComponent(\textcolor{keyword}{const}\ vc::String\ \&\ name)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \_\_world.component<T>();}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvenom_1_1common_1_1_venom_component}{vc::VenomComponent}}\ *\ component\ =\ \textcolor{keyword}{new}\ T();}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ vc::String\ displayName\ =\ component-\/>GetComponentTitle();}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \_\_componentsCreateAndHasFuncs.emplace\_back(MakeTuple<vc::String,\ vc::String,\ vc::Function<void,\ Entity>,\ vc::Function<bool,\ Entity>>(}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ name,}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ displayName,}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ [](Entity\ entity)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entity.emplace<T>();}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ [](Entity\ entity)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ entity.has<T>();}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ ));}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ component;}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#define\ REGISTER\_COMPONENT(T)\ vc::ECS::GetECS()-\/>RegisterComponent<T>(\#T)}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ Entity\ CreateEntity();}
\DoxyCodeLine{00115\ \ \ \ \ Entity\ CreateEntity(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name);}
\DoxyCodeLine{00116\ \ \ \ \ Entity\ CreatePrefab(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name);}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Entity\ GetEntity(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ECS::GetECS()-\/>\_\_GetEntity(name);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}...\ Comps,\ \textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{00122\ \ \ \ \ System\ CreateSystem(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_world.system<Comps...>(name);}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ ForEach(\textcolor{keyword}{auto}\ \&\&\ func)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ ECS::GetECS()-\/>\_\_ForEach<Args...>(func);}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ Each(\textcolor{keyword}{auto}\ \&\&\ func)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ ECS::GetECS()-\/>\_\_Each(func);}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keyword}{static}\ vc::String\ GenerateUniqueEntityName();}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ IsNameAvailable(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{static}\ ECS\ *\ GetECS();}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ UpdateWorld();}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{void}\ \_\_ForEach(\textcolor{keyword}{auto}\ \&\&\ func)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ flecs::query<Args...>\ q\ =\ \_\_world.query<Args...>();}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ q.each(func);}
\DoxyCodeLine{00147\ \ \ \ \ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ \_\_Each(\textcolor{keyword}{auto}\ \&\&\ func)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ query\ =\ \_\_world.query\_builder<>().build();}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ query.each(func);}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keyword}{static}\ ECS\ *\ s\_ecs;}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ Entity\ \_\_GetEntity(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_world.lookup(name);}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ vc::UMap<vc::String,\ vc::Function<bool,\ Entity>>\ \&\ \_\_GetComponentCanCreateFuncs();}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keyword}{static}\ Entity\ \_\_currentEntity;}
\DoxyCodeLine{00163\ \ \ \ \ flecs::world\ \_\_world;}
\DoxyCodeLine{00164\ \ \ \ \ vc::Vector<vc::Tuple<vc::String,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ vc::String,}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ vc::Function<void,\ Entity>,}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ vc::Function<bool,\ Entity>}
\DoxyCodeLine{00168\ \ \ \ \ >>\ \_\_componentsCreateAndHasFuncs;}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }GUI;}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }VenomComponent;}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }StaticVenomCanCreateComponent;}
\DoxyCodeLine{00173\ \};}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ Entity\ CreatePrefab(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name);}
\DoxyCodeLine{00176\ Entity\ CreateEntity(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ name);}
\DoxyCodeLine{00177\ Entity\ CreateEntity();}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ \}}

\end{DoxyCode}
